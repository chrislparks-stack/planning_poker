fragment UserFragment on User {
    id
    username
    lastCardPicked
    lastCardValue
    lastSeenChatMessageId
}

fragment DeckFragment on Deck {
    id
    cards
}

fragment UserCardFragment on UserCard {
    userId
    card
}

fragment GameFragment on Game {
    id
    table {
        ...UserCardFragment
    }
}

fragment ChatPositionFragment on ChatPosition {
    x
    y
    width
    height
}

fragment ChatMessageFragment on ChatMessage {
    id
    roomId
    userId
    username
    content
    formattedContent
    contentType
    timestamp
    position {
        ...ChatPositionFragment
    }
}

fragment RoomFragment on Room {
    id
    name
    isGameOver
    roomOwnerId
    users {
        ...UserFragment
    }
    bannedUsers
    deck {
        ...DeckFragment
    }
    game {
        ...GameFragment
    }
    countdownEnabled
    revealStage
    countdownValue
    confirmNewGame
    chatHistory { ...ChatMessageFragment }
}

fragment RoomEventFragment on RoomEvent {
    roomId
    eventType
    targetUserId
    room {
        ...RoomFragment
    }
}

mutation CreateRoom($roomId: UUID, $name: String, $cards: [String!]!) {
    createRoom(roomId: $roomId, name: $name, cards: $cards) {
        ...RoomFragment
    }
}

mutation CreateUser($username: String!) {
    createUser(username: $username) {
        ...UserFragment
    }
}

mutation JoinRoom($roomId: UUID!, $user: UserInput!, $roomOwnerId: UUID) {
    joinRoom(roomId: $roomId, user: $user, roomOwnerId: $roomOwnerId) {
        ...RoomFragment
    }
}

mutation UpdateDeck($roomId: UUID!, $cards: [String!]!) {
    updateDeck(input: { roomId: $roomId, cards: $cards }) {
        ...RoomFragment
    }
}

mutation RenameRoom($roomId: UUID!, $name: String) {
    renameRoom(roomId: $roomId, name: $name) {
        ...RoomFragment
    }
}

mutation ToggleCountdownOption($roomId: UUID!, $enabled: Boolean!) {
    toggleCountdownOption(roomId: $roomId, enabled: $enabled) {
        ...RoomFragment
    }
}

mutation StartRevealCountdown($roomId: UUID!, $userId: UUID) {
    startRevealCountdown(roomId: $roomId, userId: $userId) {
        ...RoomFragment
    }
}

mutation CancelRevealCountdown($roomId: UUID!, $userId: UUID) {
    cancelRevealCountdown(roomId: $roomId, userId: $userId) {
        ...RoomFragment
    }
}

mutation SetRoomOwner($roomId: UUID!, $userId: UUID) {
    setRoomOwner(roomId: $roomId, userId: $userId) {
        ...RoomFragment
    }
}

mutation EditUser($userId: UUID!, $username: String!) {
    editUser(userId: $userId, username: $username) {
        ...UserFragment
    }
}

mutation Logout($userId: UUID!) {
    logout(userId: $userId)
}

mutation PickCard($userId: UUID!, $roomId: UUID!, $card: String!) {
    pickCard(userId: $userId, roomId: $roomId, card: $card) {
        ...RoomFragment
    }
}

mutation ShowCards($roomId: UUID!) {
    showCards(roomId: $roomId) {
        ...RoomFragment
    }
}

mutation ResetGame($roomId: UUID!) {
    resetGame(roomId: $roomId) {
        ...RoomFragment
    }
}

mutation KickUser($roomId: UUID!, $targetUserId: UUID!) {
    kickUser(roomId: $roomId, targetUserId: $targetUserId) {
        ...RoomFragment
    }
}

mutation BanUser($roomId: UUID!, $targetUserId: UUID!) {
    banUser(roomId: $roomId, targetUserId: $targetUserId) {
        ...RoomFragment
    }
}

mutation UnbanUser($roomId: UUID!, $targetUserId: UUID!) {
    unbanUser(roomId: $roomId, targetUserId: $targetUserId) {
        ...RoomFragment
    }
}

mutation ToggleConfirmNewGame($roomId: UUID!, $enabled: Boolean!) {
    toggleConfirmNewGame(roomId: $roomId, enabled: $enabled) {
        ...RoomFragment
    }
}

# === Chat Operations ===

mutation SendChatMessage(
    $roomId: UUID!
    $userId: UUID!
    $username: String!
    $content: String!
    $formattedContent: String
    $contentType: String!
    $position: ChatPositionInput
) {
    sendChatMessage(
        input: {
            roomId: $roomId
            userId: $userId
            username: $username
            content: $content
            formattedContent: $formattedContent
            contentType: $contentType
            position: $position
        }
    ) {
        ...ChatMessageFragment
    }
}

mutation MarkChatSeen($roomId: UUID!, $userId: UUID!) {
    markChatSeen(roomId: $roomId, userId: $userId) {
        id
        hasUnreadChat(userId: $userId)
    }
}

# === Subscriptions & Queries ===
subscription Room($roomId: UUID!) {
    room(roomId: $roomId) {
        ...RoomFragment
    }
}

subscription RoomChat($roomId: UUID!) {
    roomChat(roomId: $roomId) {
        ...ChatMessageFragment
    }
}

subscription RoomEvents($roomId: UUID!) {
    roomEvents(roomId: $roomId) {
        ...RoomEventFragment
    }
}

subscription RoomUnread($roomId: UUID!, $userId: UUID!) {
    room(roomId: $roomId) {
        id
        hasUnreadChat(userId: $userId)
    }
}

query GetRoom($roomId: UUID!) {
    roomById(roomId: $roomId) {
        ...RoomFragment
    }
}

query GetRoomUnread($roomId: UUID!, $userId: UUID!) {
    roomById(roomId: $roomId) {
        id
        hasUnreadChat(userId: $userId)
    }
}
